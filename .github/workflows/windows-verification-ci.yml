name: JRuby CI

on: [push, pull_request]

env:
  JAVA_OPTS: '-XX:+TieredCompilation -XX:TieredStopAtLevel=1 -Xms60M -Xmx1G -XX:InitialCodeCacheSize=40M -XX:ReservedCodeCacheSize=120M'

permissions:
  contents: read

jobs:

  rake-test:
    runs-on: windows-latest

    strategy:
      matrix:
        java-version: ['21', '25']
      fail-fast: false

    name: windows verification (Java ${{ matrix.java-version }})

    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: set up java ${{ matrix.java-version }}
        uses: actions/setup-java@v3
        with:
          distribution: 'zulu'
          java-version: ${{ matrix.java-version }}
          cache: 'maven'
      - name: bootstrap
        run: mvn -ntp -Pbootstrap clean package
      - name: bundle install
        run: bin/jruby --dev -S bundle install
      - name: jruby rails_runner
        shell: cmd
        run: |
          set PATH=%CD%\bin;%PATH%
          jruby tool/rails_runner
